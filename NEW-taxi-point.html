<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi Points Map</title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.25/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.25/"></script>
    <style>
        html, body, #viewDiv {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>

<div id="viewDiv"></div>

<script>
    require([
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/GraphicsLayer",
        "esri/Graphic",
        "esri/popup/PopupTemplate"
    ], function(Map, MapView, GraphicsLayer, Graphic, PopupTemplate) {
        
        // Create the map and view
        const map = new Map({
            basemap: "streets-navigation-vector"
        });

        const view = new MapView({
            container: "viewDiv",
            map: map,
            center: [114.185, 22.285], // Longitude, latitude
            zoom: 12
        });

        // Load the CSV data
        const csvUrl = 'https://raw.githubusercontent.com/KU1311/taxi_info/main/taxipoints_csv.csv';
        fetch(csvUrl)
            .then(response => response.text())
            .then(csvData => {
                const data = csvData.split('\n').slice(1).map(row => {
                    const columns = row.split(',');
                    return {
                        id: columns[0],
                        type: columns[1],
                        name: columns[2],
                        time: columns[3],
                        dangerous: columns[4],
                        legal: columns[5],
                        remarks: columns[6],
                        lat: parseFloat(columns[7]),
                        lng: parseFloat(columns[8])
                    };
                });

                // Create a graphics layer for markers
                const graphicsLayer = new GraphicsLayer();
                map.add(graphicsLayer);

                data.forEach(row => {
                    const point = {
                        type: "point",
                        longitude: row.lng,
                        latitude: row.lat
                    };

                    const pointGraphic = new Graphic({
                        geometry: point,
                        symbol: {
                            type: "simple-marker",
                            color: "blue",
                            size: "8px"
                        },
                        attributes: {
                            id: row.id,
                            type: row.type,
                            name: row.name,
                            time: row.time,
                            dangerous: row.dangerous,
                            legal: row.legal,
                            remarks: row.remarks
                        },
                        popupTemplate: new PopupTemplate({
                            title: "{name}",
                            content: `
                                <b>的士種類:</b> {type}<br>
                                <b>時間:</b> {time}<br>
                                <b>站點種類:</b> {legal}<br>
                            `
                        })
                    });

                    // Add the graphic to the graphics layer
                    graphicsLayer.add(pointGraphic);
                });
            })
            .catch(error => console.error("Error loading CSV data:", error));
    });
</script>

</body>
</html>
